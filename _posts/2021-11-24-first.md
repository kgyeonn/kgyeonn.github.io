---
layout: single
title:  "[Tableau]도시소멸지수구하기-(1)"
---

# Tableau 도시소멸지수 구하기

> ※ 첫번째 페이지 요구사항
>
> 1. 도시소멸지수를 생성하여 시도/시군구별 소멸위험 지역을 보여주세요
> 2. 20~39세의 가임여성 수 비율을 보여주세요
> 3. 시도별 20~39세의 가임여성 수를 보여주세요
> 4. 65세 이상의 고령자 수 비율을 보여주세요
> 5. 시도별 65세 이상의 고령자 수를 보여주세요
> 6. 1부터 5까지 지표를 활용해서 대시보드 화면을 구성해주세요



## 1. 테이블 확인하기

 ![스크린샷 2022-11-04 오후 3.05.57.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/42c9f94e-1202-4347-ae02-2b7f582f3445/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-11-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.05.57.png)

![스크린샷 2022-11-04 오후 3.08.07.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d283e9c7-c5ca-48ff-9bc1-0fff14a148d1/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-11-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.08.07.png)

- 데이터를 확인해본 결과 231개 열과 18668개의 행으로 구성되어 있음을 알 수 있다.
- 각 열은 성별연령별로 각각 나누어져서 측정값으로 구분되어 있다.

## 2. 피벗 만들기

![스크린샷 2022-11-04 오후 3.11.11.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/beb5994c-5ce1-4d47-b740-e4a49aa8100e/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-11-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.11.11.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e71339f7-38ac-4427-9a49-5f54523696dd/Untitled.png)

- 피벗함수를 사용할 열을 선택하여 피벗 테이블을 만들어 준다.
- 피벗필드명과 피벗 필드값 열이 생성됨을 볼 수 있다.

## 3. 피벗필드명 데이터 정규화

```sql
 # REGEXP_EXTRACT(문자열, 패턴) 
 # ex) REGEXP_EXTRACT(’abc 123’, ‘[a-z]+\s+(\d+)’) = ‘123’
 
 REGEXP_EXTRACT(문자열, 패턴)** 예 : REGEXP_EXTRACT(’abc 123’, ‘[a-z]+\s+(\d+)’) = ‘123’
```

```sql
# REGEXP_MATCH(문자열, 패턴) 
# ex) REGEXP_MATCH(’-([1234].[The.Market ])-’, ‘\[\s*(\w*\.)(\w*\s*\])’) = true

REGEXP_MATCH(문자열, 패턴)
예 : REGEXP_MATCH(’-([1234].[The.Market ])-’, ‘\[\s*(\w*\.)(\w*\s*\])’) = true
```

![스크린샷 2022-11-04 오후 3.27.23.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fd90062c-fb0c-494d-9413-1f35dffcc43d/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-11-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.27.23.png)

- 정규화 함수를 통하여 C_연령, C_성별 필드를 새로 생성하였다. 

## 4. 가임여성과 고령자 구분하기

> 참고1. 도시소멸지수는 20~39세 여성을 65세 이상 고령자로 나눈 값임.
>
> 참고2. 도시소멸지수가 0.5 이하인 경우를 소멸위험 지역으로 분류

### 가임여성 구분

```sql
# 가임여성 T/F 테이블
[C_성별]=='여성' AND
[C_연령]> 19 and [C_연령]<40

# 가임여성 수 측정값 
IF [C_성별]=='여성' AND
   [C_연령]> 19 and [C_연령]<40 THEN [피벗 필드 값]
END
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/17557265-a2c8-4f67-add1-159217362e2a/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3e18181c-ea5f-4c90-b855-dde8371659b2/Untitled.png)

### 고령자 구분

```sql
# 고령자 T/F 테이블
[C_연령] > 64

# 고령자수 측정값 
IF [C_연령] > 64 THEN [피벗 필드 값]
END
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c0b0fc17-3c70-47c7-b42f-3359e6675db7/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d16393ef-a5ad-469d-a390-1ef8d1287f11/Untitled.png)

## 5. 도시소멸지수 구하기

```sql
# 도시소멸지수 측정값 
SUM([가임여성수])/SUM([고령자수])

# 도시소멸지수 측정값 
SUM([가임여성수])/SUM([고령자수])
```

