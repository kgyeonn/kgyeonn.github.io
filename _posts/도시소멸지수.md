---
layout: single
title:  "[Tableau]도시소멸지수구하기-(1)"
typora-root-url: ../_images
---

> ※ 첫번째 페이지 요구사항
>
> 1. 도시소멸지수를 생성하여 시도/시군구별 소멸위험 지역을 보여주세요
> 2. 20~39세의 가임여성 수 비율을 보여주세요
> 3. 시도별 20~39세의 가임여성 수를 보여주세요
> 4. 65세 이상의 고령자 수 비율을 보여주세요
> 5. 시도별 65세 이상의 고령자 수를 보여주세요
> 6. 1부터 5까지 지표를 활용해서 대시보드 화면을 구성해주세요



## 1. 테이블 확인하기

![테이블확인](/테이블확인.png)

![테이블확인2](/테이블확인2.png)

- 데이터를 확인해본 결과 231개 열과 18668개의 행으로 구성되어 있음을 알 수 있다.


- 각 열은 성별연령별로 각각 나누어져서 측정값으로 구분되어 있다.

## 2. 피벗 만들기

![피벗만들기](/피벗만들기.png)

![피벗테이블생성](/피벗테이블생성.png)

- 피벗함수를 사용할 열을 선택하여 피벗 테이블을 만들어 준다.
- 피벗필드명과 피벗 필드값 열이 생성됨을 볼 수 있다.

## 3. 피벗필드명 데이터 정규화

```sql
 # REGEXP_EXTRACT(문자열, 패턴) 
 # ex) REGEXP_EXTRACT(’abc 123’, ‘[a-z]+\s+(\d+)’) = ‘123’
 
 REGEXP_EXTRACT(문자열, 패턴)** 예 : REGEXP_EXTRACT(’abc 123’, ‘[a-z]+\s+(\d+)’) = ‘123’
```

```sql
# REGEXP_MATCH(문자열, 패턴) 
# ex) REGEXP_MATCH(’-([1234].[The.Market ])-’, ‘\[\s*(\w*\.)(\w*\s*\])’) = true

REGEXP_MATCH(문자열, 패턴)
예 : REGEXP_MATCH(’-([1234].[The.Market ])-’, ‘\[\s*(\w*\.)(\w*\s*\])’) = true
```

![연령성별생성](/연령성별생성.png)

- 정규화 함수를 통하여 C_연령, C_성별 필드를 새로 생성하였다. 

## 4. 가임여성과 고령자 구분하기

> 참고1. 도시소멸지수는 20~39세 여성을 65세 이상 고령자로 나눈 값임.
>
> 참고2. 도시소멸지수가 0.5 이하인 경우를 소멸위험 지역으로 분류

### 가임여성 구분

```sql
# 가임여성 T/F 테이블
[C_성별]=='여성' AND
[C_연령]> 19 and [C_연령]<40

# 가임여성 수 측정값 
IF [C_성별]=='여성' AND
   [C_연령]> 19 and [C_연령]<40 THEN [피벗 필드 값]
END
```

![가임여성파이차트](/가임여성파이차트.png)

![가임여성막대차트](/가임여성막대차트.png)

### 고령자 구분

```sql
# 고령자 T/F 테이블
[C_연령] > 64

# 고령자수 측정값 
IF [C_연령] > 64 THEN [피벗 필드 값]
END
```

![고령자파이차트](/고령자파이차트.png)

![고령자막대차트](/고령자막대차트.png)

## 5. 도시소멸지수 구하기

```sql
# 도시소멸지수 측정값 
SUM([가임여성수])/SUM([고령자수])

# 도시소멸지수 측정값 
SUM([가임여성수])/SUM([고령자수])
```

![도시소멸측정값](/도시소멸측정값.png)

![도시소멸지수(시도)](/도시소멸지수(시도).png)
![도시소멸지수(시군구)](/도시소멸지수(시군구).png)

## 6. 대시보드화면

![도시소멸지수대시보드](/도시소멸지수대시보드.png)

